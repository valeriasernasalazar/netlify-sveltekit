import{s as $,c as w,u as S,g as b,a as y,o as R}from"../chunks/scheduler.2ExYYgC5.js";import{S as U,i as A,e as C,c as F,a as q,d as _,b as I,f as M,t as T,g as W}from"../chunks/index.BEfN5G4a.js";import{a as j,d as m,b as g,g as p,s as x,c as z}from"../chunks/store.Czkyq5IA.js";import{g as f}from"../chunks/entry.BGfAofGz.js";function E(u){let s,r;const d=u[1].default,e=w(d,u,u[0],null);return{c(){s=C("div"),e&&e.c(),this.h()},l(t){s=F(t,"DIV",{class:!0});var n=q(s);e&&e.l(n),n.forEach(_),this.h()},h(){I(s,"class","mainContainer svelte-qiddj4")},m(t,n){M(t,s,n),e&&e.m(s,null),r=!0},p(t,[n]){e&&e.p&&(!r||n&1)&&S(e,d,t,t[0],r?y(d,t[0],n,null):b(t[0]),null)},i(t){r||(T(e,t),r=!0)},o(t){W(e,t),r=!1},d(t){t&&_(s),e&&e.d(t)}}}function L(u,s,r){let{$$slots:d={},$$scope:e}=s;const t=["/"];async function n(i){console.log("Obteniendo rol del usuario con UID:",i);const o=m(g,"users",i),a=await p(o);if(console.log("Documento Firestore existe:",a.exists()),a.exists()){const l=a.data();return console.log("Datos del documento Firestore:",l),l.role}return"mortal"}async function v(i,o){if(!i)return!1;const a=await n(i.uid);return console.log(`Rol del usuario encontrado: ${a}`),!(o.startsWith("/admin")&&a!=="admin"||o.startsWith("/nivel2")&&a==="mortal")}return R(()=>{console.log("Montando layout");const i=j.onAuthStateChanged(async o=>{const a=window.location.pathname;if(!o&&!t.includes(a)){f("/");return}if(o&&a==="/"){const c=await n(o.uid);c==="admin"?f("/admin"):c==="nivel2"?f("/nivel2"):f("/mortal");return}if(o&&!await v(o,a)){f("/");return}if(!o)return;let l;const D=m(g,"users",o.uid),h=await p(D);if(h.exists())console.log("Fetching User"),l=h.data();else{const c=m(g,"users",o.uid);l={email:o.email,todos:[],role:"mortal"},await x(c,l,{merge:!0})}z.update(c=>({...c,user:o,data:l,loading:!1}))});return()=>i()}),u.$$set=i=>{"$$scope"in i&&r(0,e=i.$$scope)},[e,d]}class G extends U{constructor(s){super(),A(this,s,L,E,$,{})}}export{G as component};
