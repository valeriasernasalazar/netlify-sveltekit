import{s as ve,n as F,r as oe,o as pe,h as se}from"../chunks/scheduler.2ExYYgC5.js";import{S as me,i as Ce,e as h,s as q,c as v,a as w,n as U,k as z,d as p,b as g,f as P,l as m,o as B,x as te,h as J,j as G,m as Z,q as L,y as W,u as he}from"../chunks/index.BEfN5G4a.js";import{e as $}from"../chunks/each.D6YF6ztN.js";import{c as be,d as le,b as Y,g as ie,j as ye,k as ge,u as ne,l as ke,e as Ee,s as Te}from"../chunks/store.Czkyq5IA.js";import{g as re}from"../chunks/entry.BGfAofGz.js";var Oe={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};function ue(a,e,t){const l=a.slice();return l[9]=e[t],l}function ce(a,e,t){const l=a.slice();return l[9]=e[t],l}function Se(a){let e,t="No tienes permisos para modificar usuarios.";return{c(){e=h("p"),e.textContent=t,this.h()},l(l){e=v(l,"P",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-1dth54i"&&(e.textContent=t),this.h()},h(){g(e,"class","svelte-14yiauo")},m(l,i){P(l,e,i)},p:F,d(l){l&&p(e)}}}function Ie(a){let e,t;function l(r,n){return r[7]?Pe:Ne}let i=l(a),o=i(a),s=a[4]&&de(a);return{c(){e=h("div"),o.c(),t=q(),s&&s.c(),this.h()},l(r){e=v(r,"DIV",{class:!0});var n=w(e);o.l(n),t=z(n),s&&s.l(n),n.forEach(p),this.h()},h(){g(e,"class","form-group svelte-14yiauo")},m(r,n){P(r,e,n),o.m(e,null),m(e,t),s&&s.m(e,null)},p(r,n){i===(i=l(r))&&o?o.p(r,n):(o.d(1),o=i(r),o&&(o.c(),o.m(e,t))),r[4]?s?s.p(r,n):(s=de(r),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(r){r&&p(e),o.d(),s&&s.d()}}}function De(a){let e,t="Cargando...";return{c(){e=h("p"),e.textContent=t,this.h()},l(l){e=v(l,"P",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-dtqfh9"&&(e.textContent=t),this.h()},h(){g(e,"class","svelte-14yiauo")},m(l,i){P(l,e,i)},p:F,d(l){l&&p(e)}}}function Ne(a){let e,t,l="Selecciona un usuario",i,o,s,r="Selecciona el nuevo nivel",n,E="Usuario (Nivel 1)",u,N="Servicios (Nivel 2)",f,C="Administrador (Nivel 3)",d,b,_="Actualizar Rol",O,M,A=$(a[0]),T=[];for(let c=0;c<A.length;c+=1)T[c]=fe(ce(a,A,c));return{c(){e=h("select"),t=h("option"),t.textContent=l;for(let c=0;c<T.length;c+=1)T[c].c();i=q(),o=h("select"),s=h("option"),s.textContent=r,n=h("option"),n.textContent=E,u=h("option"),u.textContent=N,f=h("option"),f.textContent=C,d=q(),b=h("button"),b.textContent=_,this.h()},l(c){e=v(c,"SELECT",{class:!0});var D=w(e);t=v(D,"OPTION",{"data-svelte-h":!0}),U(t)!=="svelte-1vh9ism"&&(t.textContent=l);for(let R=0;R<T.length;R+=1)T[R].l(D);D.forEach(p),i=z(c),o=v(c,"SELECT",{class:!0});var y=w(o);s=v(y,"OPTION",{"data-svelte-h":!0}),U(s)!=="svelte-1ghrehz"&&(s.textContent=r),n=v(y,"OPTION",{"data-svelte-h":!0}),U(n)!=="svelte-ta998o"&&(n.textContent=E),u=v(y,"OPTION",{"data-svelte-h":!0}),U(u)!=="svelte-1jostw3"&&(u.textContent=N),f=v(y,"OPTION",{"data-svelte-h":!0}),U(f)!=="svelte-qxuc2w"&&(f.textContent=C),y.forEach(p),d=z(c),b=v(c,"BUTTON",{class:!0,"data-svelte-h":!0}),U(b)!=="svelte-5tv11c"&&(b.textContent=_),this.h()},h(){t.__value="",L(t,t.__value),t.disabled=!0,t.selected=!0,g(e,"class","input-field svelte-14yiauo"),a[1]===void 0&&se(()=>a[14].call(e)),s.__value="",L(s,s.__value),s.disabled=!0,s.selected=!0,n.__value="usuario",L(n,n.__value),u.__value="servicios",L(u,u.__value),f.__value="administrador",L(f,f.__value),g(o,"class","input-field svelte-14yiauo"),a[3]===void 0&&se(()=>a[15].call(o)),g(b,"class","submit-btn svelte-14yiauo")},m(c,D){P(c,e,D),m(e,t);for(let y=0;y<T.length;y+=1)T[y]&&T[y].m(e,null);W(e,a[1],!0),P(c,i,D),P(c,o,D),m(o,s),m(o,n),m(o,u),m(o,f),W(o,a[3],!0),P(c,d,D),P(c,b,D),O||(M=[B(e,"change",a[14]),B(o,"change",a[15]),B(b,"click",a[10])],O=!0)},p(c,D){if(D&1){A=$(c[0]);let y;for(y=0;y<A.length;y+=1){const R=ce(c,A,y);T[y]?T[y].p(R,D):(T[y]=fe(R),T[y].c(),T[y].m(e,null))}for(;y<T.length;y+=1)T[y].d(1);T.length=A.length}D&3&&W(e,c[1]),D&8&&W(o,c[3])},d(c){c&&(p(e),p(i),p(o),p(d),p(b)),he(T,c),O=!1,oe(M)}}}function Pe(a){let e,t="Cargando usuarios...";return{c(){e=h("p"),e.textContent=t,this.h()},l(l){e=v(l,"P",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-1qnei9g"&&(e.textContent=t),this.h()},h(){g(e,"class","svelte-14yiauo")},m(l,i){P(l,e,i)},p:F,d(l){l&&p(e)}}}function fe(a){let e,t=a[9].email+"",l,i,o=a[9].role+"",s,r,n;return{c(){e=h("option"),l=J(t),i=J(" ("),s=J(o),r=J(")"),this.h()},l(E){e=v(E,"OPTION",{});var u=w(e);l=G(u,t),i=G(u," ("),s=G(u,o),r=G(u,")"),u.forEach(p),this.h()},h(){e.__value=n=a[9].id,L(e,e.__value)},m(E,u){P(E,e,u),m(e,l),m(e,i),m(e,s),m(e,r)},p(E,u){u&1&&t!==(t=E[9].email+"")&&Z(l,t),u&1&&o!==(o=E[9].role+"")&&Z(s,o),u&1&&n!==(n=E[9].id)&&(e.__value=n,L(e,e.__value))},d(E){E&&p(e)}}}function de(a){let e,t;return{c(){e=h("p"),t=J(a[4]),this.h()},l(l){e=v(l,"P",{class:!0});var i=w(e);t=G(i,a[4]),i.forEach(p),this.h()},h(){g(e,"class","error svelte-14yiauo")},m(l,i){P(l,e,i),m(e,t)},p(l,i){i&16&&Z(t,l[4])},d(l){l&&p(e)}}}function Ue(a){let e,t,l,i="Selecciona un usuario",o,s,r,n,E="Eliminar Usuario",u,N,f=$(a[0].filter(a[16])),C=[];for(let d=0;d<f.length;d+=1)C[d]=_e(ue(a,f,d));return{c(){e=h("div"),t=h("select"),l=h("option"),l.textContent=i;for(let d=0;d<C.length;d+=1)C[d].c();o=q(),s=h("input"),r=q(),n=h("button"),n.textContent=E,this.h()},l(d){e=v(d,"DIV",{class:!0});var b=w(e);t=v(b,"SELECT",{class:!0});var _=w(t);l=v(_,"OPTION",{"data-svelte-h":!0}),U(l)!=="svelte-1vh9ism"&&(l.textContent=i);for(let O=0;O<C.length;O+=1)C[O].l(_);_.forEach(p),o=z(b),s=v(b,"INPUT",{type:!0,placeholder:!0,class:!0}),r=z(b),n=v(b,"BUTTON",{class:!0,"data-svelte-h":!0}),U(n)!=="svelte-ykg1bw"&&(n.textContent=E),b.forEach(p),this.h()},h(){l.__value="",L(l,l.__value),l.disabled=!0,l.selected=!0,g(t,"class","input-field svelte-14yiauo"),a[2]===void 0&&se(()=>a[17].call(t)),g(s,"type","password"),g(s,"placeholder","Contraseña"),g(s,"class","input-field svelte-14yiauo"),g(n,"class","delete-btn svelte-14yiauo"),g(e,"class","form-group svelte-14yiauo")},m(d,b){P(d,e,b),m(e,t),m(t,l);for(let _=0;_<C.length;_+=1)C[_]&&C[_].m(t,null);W(t,a[2],!0),m(e,o),m(e,s),L(s,a[8]),m(e,r),m(e,n),u||(N=[B(t,"change",a[17]),B(s,"input",a[18]),B(n,"click",a[11])],u=!0)},p(d,b){if(b&513){f=$(d[0].filter(d[16]));let _;for(_=0;_<f.length;_+=1){const O=ue(d,f,_);C[_]?C[_].p(O,b):(C[_]=_e(O),C[_].c(),C[_].m(t,null))}for(;_<C.length;_+=1)C[_].d(1);C.length=f.length}b&5&&W(t,d[2]),b&256&&s.value!==d[8]&&L(s,d[8])},d(d){d&&p(e),he(C,d),u=!1,oe(N)}}}function we(a){let e,t="Cargando usuarios...";return{c(){e=h("p"),e.textContent=t,this.h()},l(l){e=v(l,"P",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-1qnei9g"&&(e.textContent=t),this.h()},h(){g(e,"class","svelte-14yiauo")},m(l,i){P(l,e,i)},p:F,d(l){l&&p(e)}}}function _e(a){let e,t=a[9].email+"",l,i;return{c(){e=h("option"),l=J(t),this.h()},l(o){e=v(o,"OPTION",{});var s=w(e);l=G(s,t),s.forEach(p),this.h()},h(){e.__value=i=a[9].id,L(e,e.__value)},m(o,s){P(o,e,s),m(e,l)},p(o,s){s&513&&t!==(t=o[9].email+"")&&Z(l,t),s&513&&i!==(i=o[9].id)&&(e.__value=i,L(e,e.__value))},d(o){o&&p(e)}}}function Re(a){let e,t,l,i,o='<i class="fa-solid fa-arrow-left"></i> <p class="svelte-14yiauo">Inicio</p>',s,r,n='<i class="fa-solid fa-right-from-bracket"></i> <p class="svelte-14yiauo">Cerrar Sesión</p>',E,u,N,f,C,d="Modificar Usuarios",b,_,O,M,A="Eliminar Usuarios",T,c,D;function y(k,V){return k[6]?De:k[5]?Ie:Se}let R=y(a),H=R(a);function I(k,V){return k[7]?we:Ue}let x=I(a),S=x(a);return{c(){e=h("div"),t=h("div"),l=h("div"),i=h("button"),i.innerHTML=o,s=q(),r=h("button"),r.innerHTML=n,E=q(),u=h("div"),N=h("div"),f=h("div"),C=h("h1"),C.textContent=d,b=q(),H.c(),_=q(),O=h("div"),M=h("h1"),M.textContent=A,T=q(),S.c(),this.h()},l(k){e=v(k,"DIV",{class:!0});var V=w(e);t=v(V,"DIV",{class:!0});var ee=w(t);l=v(ee,"DIV",{class:!0});var j=w(l);i=v(j,"BUTTON",{class:!0,"data-svelte-h":!0}),U(i)!=="svelte-92lfck"&&(i.innerHTML=o),s=z(j),r=v(j,"BUTTON",{class:!0,"data-svelte-h":!0}),U(r)!=="svelte-16i77t5"&&(r.innerHTML=n),j.forEach(p),ee.forEach(p),V.forEach(p),E=z(k),u=v(k,"DIV",{class:!0});var ae=w(u);N=v(ae,"DIV",{class:!0});var K=w(N);f=v(K,"DIV",{class:!0});var Q=w(f);C=v(Q,"H1",{class:!0,"data-svelte-h":!0}),U(C)!=="svelte-2opsox"&&(C.textContent=d),b=z(Q),H.l(Q),Q.forEach(p),_=z(K),O=v(K,"DIV",{class:!0});var X=w(O);M=v(X,"H1",{class:!0,"data-svelte-h":!0}),U(M)!=="svelte-18ach8m"&&(M.textContent=A),T=z(X),S.l(X),X.forEach(p),K.forEach(p),ae.forEach(p),this.h()},h(){g(i,"class","svelte-14yiauo"),g(r,"class","svelte-14yiauo"),g(l,"class","hB svelte-14yiauo"),g(t,"class","Hc"),g(e,"class","Mc svelte-14yiauo"),g(C,"class","svelte-14yiauo"),g(f,"class","form-group-section svelte-14yiauo"),g(M,"class","svelte-14yiauo"),g(O,"class","form-group-section svelte-14yiauo"),g(N,"class","admin-container svelte-14yiauo"),g(u,"class","main-container svelte-14yiauo")},m(k,V){P(k,e,V),m(e,t),m(t,l),m(l,i),m(l,s),m(l,r),P(k,E,V),P(k,u,V),m(u,N),m(N,f),m(f,C),m(f,b),H.m(f,null),m(N,_),m(N,O),m(O,M),m(O,T),S.m(O,null),c||(D=[B(i,"click",a[12]),B(r,"click",a[13])],c=!0)},p(k,[V]){R===(R=y(k))&&H?H.p(k,V):(H.d(1),H=R(k),H&&(H.c(),H.m(f,null))),x===(x=I(k))&&S?S.p(k,V):(S.d(1),S=x(k),S&&(S.c(),S.m(O,null)))},i:F,o:F,d(k){k&&(p(e),p(E),p(u)),H.d(),S.d(),c=!1,oe(D)}}}function He(a,e,t){let l=[],i="",o="",s="",r=null,n="",E=!1,u=!0,N=!0,f="";const C={mortal:"usuario",nivel2:"servicios",admin:"administrador"},d={usuario:"mortal",servicios:"nivel2",administrador:"admin"};pe(()=>{be.subscribe(I=>{t(9,r=I.user),r?b():t(6,u=!1)}),_()});async function b(){if(r){const I=le(Y,"users",r.uid),x=await ie(I);x.exists()&&x.data().role==="admin"&&t(5,E=!0)}t(6,u=!1)}async function _(){t(7,N=!0);try{const I=await ye(ge(Y,"users"));t(0,l=I.docs.map(x=>{const S=x.data();return S.role||(S.role="mortal",ne(x.ref,{role:"mortal"})),S.role=C[S.role]||S.role,{id:x.id,...S}})),console.log("Usuarios:",l)}catch(I){console.error("Error obteniendo usuarios:",I)}t(7,N=!1)}async function O(){if(t(4,n=""),!i){t(4,n="Por favor, selecciona un correo electrónico válido.");return}if(!s){t(4,n="Por favor, selecciona un nuevo nivel.");return}try{const I=le(Y,"users",i),x=await ie(I),S=l.find(j=>j.id===i),k=d[s];x.exists()?await ne(I,{role:k}):await Te(I,{email:S.email,role:k}),(await fetch(`http://localhost:3001/${{mortal:"setMortalRole",nivel2:"setNivel2Role",admin:"setAdminRole"}[k]}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:S.email})})).ok?(alert(`Usuario actualizado a ${s}.`),t(1,i=""),t(3,s=""),await _()):t(4,n="Hubo un error al actualizar el rol del usuario en el servidor.")}catch(I){console.error("Error actualizando el rol del usuario:",I),t(4,n="Hubo un error al actualizar el rol del usuario.")}}async function M(){if(f!==Oe.VITE_REGISTRATION_PASSWORD){alert("Contraseña incorrecta.");return}try{await ke(le(Y,"users",o)),(await fetch("http://localhost:3001/deleteUser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:o})})).ok?(alert("Usuario eliminado exitosamente."),t(2,o=""),await _()):alert("Hubo un error al eliminar el usuario de la autenticación.")}catch(I){console.error("Error eliminando el usuario:",I),alert("Hubo un error al eliminar el usuario.")}finally{t(8,f="")}}const A=()=>re("/admin"),T=async()=>{await Ee.logout(),re("/")};function c(){i=te(this),t(1,i),t(0,l)}function D(){s=te(this),t(3,s)}const y=I=>r&&I.id!==r.uid;function R(){o=te(this),t(2,o),t(0,l)}function H(){f=this.value,t(8,f)}return[l,i,o,s,n,E,u,N,f,r,O,M,A,T,c,D,y,R,H]}class qe extends me{constructor(e){super(),Ce(this,e,He,Re,ve,{})}}export{qe as component};
