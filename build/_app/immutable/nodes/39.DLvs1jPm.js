import{s as M,n as E,o as V,h as B,r as J}from"../chunks/scheduler.2ExYYgC5.js";import{S as F,i as G,e as g,s as w,c as v,a as S,n as C,k as q,d as h,b as I,f as b,l as y,x as K,h as z,j as H,m as L,q as U,y as x,o as P,u as Q}from"../chunks/index.BEfN5G4a.js";import{e as N}from"../chunks/each.D6YF6ztN.js";import{c as W,j as X,k as Y,b as O,u as A,d as Z,g as $,s as ee}from"../chunks/store.Czkyq5IA.js";function D(a,e,t){const o=a.slice();return o[7]=e[t],o}function te(a){let e,t="No tienes permisos para modificar usuarios.";return{c(){e=g("p"),e.textContent=t},l(o){e=v(o,"P",{"data-svelte-h":!0}),C(e)!=="svelte-1dth54i"&&(e.textContent=t)},m(o,s){b(o,e,s)},p:E,d(o){o&&h(e)}}}function oe(a){let e,t;function o(n,i){return n[6]?se:re}let s=o(a),l=s(a),r=a[3]&&j(a);return{c(){e=g("div"),l.c(),t=w(),r&&r.c()},l(n){e=v(n,"DIV",{});var i=S(e);l.l(i),t=q(i),r&&r.l(i),i.forEach(h)},m(n,i){b(n,e,i),l.m(e,null),y(e,t),r&&r.m(e,null)},p(n,i){s===(s=o(n))&&l?l.p(n,i):(l.d(1),l=s(n),l&&(l.c(),l.m(e,t))),n[3]?r?r.p(n,i):(r=j(n),r.c(),r.m(e,null)):r&&(r.d(1),r=null)},d(n){n&&h(e),l.d(),r&&r.d()}}}function le(a){let e,t="Cargando...";return{c(){e=g("p"),e.textContent=t},l(o){e=v(o,"P",{"data-svelte-h":!0}),C(e)!=="svelte-dtqfh9"&&(e.textContent=t)},m(o,s){b(o,e,s)},p:E,d(o){o&&h(e)}}}function re(a){let e,t,o="Selecciona un usuario",s,l,r="Hacer Administrador",n,i,f=N(a[0]),d=[];for(let c=0;c<f.length;c+=1)d[c]=R(D(a,f,c));return{c(){e=g("select"),t=g("option"),t.textContent=o;for(let c=0;c<d.length;c+=1)d[c].c();s=w(),l=g("button"),l.textContent=r,this.h()},l(c){e=v(c,"SELECT",{});var m=S(e);t=v(m,"OPTION",{"data-svelte-h":!0}),C(t)!=="svelte-1vh9ism"&&(t.textContent=o);for(let u=0;u<d.length;u+=1)d[u].l(m);m.forEach(h),s=q(c),l=v(c,"BUTTON",{"data-svelte-h":!0}),C(l)!=="svelte-odnrwf"&&(l.textContent=r),this.h()},h(){t.__value="",U(t,t.__value),t.disabled=!0,t.selected=!0,a[2]===void 0&&B(()=>a[9].call(e))},m(c,m){b(c,e,m),y(e,t);for(let u=0;u<d.length;u+=1)d[u]&&d[u].m(e,null);x(e,a[2],!0),b(c,s,m),b(c,l,m),n||(i=[P(e,"change",a[9]),P(e,"change",a[10]),P(l,"click",a[8])],n=!0)},p(c,m){if(m&1){f=N(c[0]);let u;for(u=0;u<f.length;u+=1){const T=D(c,f,u);d[u]?d[u].p(T,m):(d[u]=R(T),d[u].c(),d[u].m(e,null))}for(;u<d.length;u+=1)d[u].d(1);d.length=f.length}m&5&&x(e,c[2])},d(c){c&&(h(e),h(s),h(l)),Q(d,c),n=!1,J(i)}}}function se(a){let e,t="Cargando usuarios...";return{c(){e=g("p"),e.textContent=t},l(o){e=v(o,"P",{"data-svelte-h":!0}),C(e)!=="svelte-1qnei9g"&&(e.textContent=t)},m(o,s){b(o,e,s)},p:E,d(o){o&&h(e)}}}function R(a){let e,t=a[7].email+"",o,s;return{c(){e=g("option"),o=z(t),this.h()},l(l){e=v(l,"OPTION",{});var r=S(e);o=H(r,t),r.forEach(h),this.h()},h(){e.__value=s=a[7].uid,U(e,e.__value)},m(l,r){b(l,e,r),y(e,o)},p(l,r){r&1&&t!==(t=l[7].email+"")&&L(o,t),r&1&&s!==(s=l[7].uid)&&(e.__value=s,U(e,e.__value))},d(l){l&&h(e)}}}function j(a){let e,t;return{c(){e=g("p"),t=z(a[3]),this.h()},l(o){e=v(o,"P",{class:!0});var s=S(e);t=H(s,a[3]),s.forEach(h),this.h()},h(){I(e,"class","error svelte-1tgk9jq")},m(o,s){b(o,e,s),y(e,t)},p(o,s){s&8&&L(t,o[3])},d(o){o&&h(e)}}}function ne(a){let e,t,o="Modificar Usuarios",s;function l(i,f){return i[5]?le:i[4]?oe:te}let r=l(a),n=r(a);return{c(){e=g("div"),t=g("h1"),t.textContent=o,s=w(),n.c(),this.h()},l(i){e=v(i,"DIV",{class:!0});var f=S(e);t=v(f,"H1",{"data-svelte-h":!0}),C(t)!=="svelte-2opsox"&&(t.textContent=o),s=q(f),n.l(f),f.forEach(h),this.h()},h(){I(e,"class","admin-container svelte-1tgk9jq")},m(i,f){b(i,e,f),y(e,t),y(e,s),n.m(e,null)},p(i,[f]){r===(r=l(i))&&n?n.p(i,f):(n.d(1),n=r(i),n&&(n.c(),n.m(e,null)))},i:E,o:E,d(i){i&&h(e),n.d()}}}function ae(a,e,t){let o=[],s="",l="",r=null,n="",i=!1,f=!0,d=!0;V(()=>{W.subscribe(_=>{t(7,r=_.user),r?c():t(5,f=!1)}),m()});async function c(){if(r)try{(await r.getIdTokenResult(!0)).claims.admin?(t(4,i=!0),console.log("Usuario es administrador")):console.log("Usuario no es administrador")}catch(_){console.error("Error obteniendo las reclamaciones:",_)}else console.log("No hay usuario autenticado");t(5,f=!1)}async function m(){t(6,d=!0);try{const _=await X(Y(O,"users"));t(0,o=_.docs.map(p=>{const k=p.data();return k.role||(k.role="usuario",A(p.ref,{role:"usuario"})),console.log(`Usuario: ${k.email}, Rol: ${k.role}`),{id:p.id,...k}}).filter(p=>p.role!=="administrador").map(p=>({email:p.email,uid:p.id}))),console.log("Usuarios no administradores:",o)}catch(_){console.error("Error obteniendo usuarios no administradores:",_)}t(6,d=!1)}async function u(){if(t(3,n=""),!l){t(3,n="Por favor, selecciona un correo electrónico válido.");return}try{const _=Z(O,"users",l);(await $(_)).exists()?await A(_,{role:"administrador"}):await ee(_,{email:s,role:"administrador"}),(await fetch("http://localhost:3001/setAdminRole",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})})).ok?(alert("Usuario actualizado a administrador."),t(1,s=""),t(2,l=""),await m()):t(3,n="Hubo un error al actualizar el rol del usuario en el servidor.")}catch(_){console.error("Error actualizando el rol del usuario:",_),t(3,n="Hubo un error al actualizar el rol del usuario.")}}function T(){l=K(this),t(2,l),t(0,o)}return[o,s,l,n,i,f,d,r,u,T,_=>t(1,s=o.find(p=>p.uid===_.target.value).email)]}class _e extends F{constructor(e){super(),G(this,e,ae,ne,M,{})}}export{_e as component};
